<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/designerzen.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Harmoneasy</title>
</head>

<body>

  
  <!-- Timer Bar -->
  <div id="timer-bar">
    <strong>TIMER</strong>
    <time id="clock"></time>
  </div>

  <!-- Main Header -->
  <header>
    <a class="backlink" href="/">
      <img class="logo" src="/source/assets/logos/harmoneasy.svg" alt=""> 
      <h1>Harmoneasy</h1>
      <h2>Play with friends</h2>
    </a>
    <div class="header-controls">
      <div id="tempo-control" class="controls">
         <label>
           Tempo:
           <input id="tempo" type="range" min=10 max=303>
           <output id="bpm"></output>
           BPM
         </label>
       </div>
       <div id="volume-control" class="controls">
         <label>
           Volume:
           <input id="volume" type="range" min=0 max=100 value=50>
           <output id="volume-output">50</output>
           %
         </label>
       </div>
      <div class="device-buttons">
        <button type="button" id="btn-random-timbre">Random Timbre</button>
        <button type="button" id="btn-connect-to-ble">Connect Bluetooth</button>
        <button type="button" id="btn-toggle-webmidi">Connect WebMIDI</button>
        <button type="button" id="btn-kill-switch" class="kill-switch">All Notes Off</button>
      </div>
    </div>
  </header>


  <!-- Action Bar -->
  <div id="action-bar">
    <button type="button" id="btn-export-midi">Export as MIDI file</button>
    <button type="button" id="btn-audiotool-export">Open in AudioTool</button>
  </div>

  <!-- Sidebar for MIDI Events -->
  <aside id="sidebar">
    <div id="sidebar-header">
      <h4>MIDI Events</h4>
      <button id="sidebar-close">&times;</button>
    </div>

    <div id="sidebar-content">
      <output id="midi-devices"></output>
      <output id="midi-input-commands"></output>
      <output id="midi-output-commands"></output>

      <div id="ble-manual-send-fieldset" hidden>
        <legend>Manual BLE Send</legend>

        <label for="midi-channel-selector">BLE MIDI Channel:
          <select id="midi-channel-selector">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="14">14</option>
            <option value="15">15</option>
            <option value="16">16</option>
          </select>
        </label>

        <label for="ble-manual-input">Manual BLE Send
          <input id="ble-manual-input" type="text" placeholder="Enter bytes e.g. 144,60,127">
        </label>

        <button type="button" id="btn-send-ble-manual">Send BLE</button>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main>
    <!-- Graph Container -->
    <div id="graph-container">
      <div id="app"></div>
      <div id="graph"></div>
    </div>

    <!-- Keyboard Container -->
    <div id="keyboard-container">
      <canvas id="wallpaper" width="1920" height="1080"></canvas>
    </div>
  </main>

  <!-- Hidden form for backward compatibility -->
  <form id="options" style="display: none;">
    <fieldset id="midi-settings-fieldset"></fieldset>
    <fieldset id="midi-controls"></fieldset>
  </form>


  <footer>
  </footer>

  <!-- Export Overlay -->
  <div id="export-overlay" class="export-overlay" style="display: none;">
    <div class="export-overlay-content">
      <div class="spinner"></div>
      <h3>Exporting to AudioTool...</h3>
      <p>Please wait while we create your project</p>
    </div>
  </div>

    <h3></h3>
    <p id="error-message"></p>
    <p id="error-solution"></p>
    <form>
      <button class="error-close-button" type="dialog">Close</button>
    </form>
  </dialog>

  <script type="module" src="/source/index.ts"></script>
  <script>
    // Sidebar toggle functionality
    const timerBar = document.getElementById('timer-bar');
    const sidebar = document.getElementById('sidebar');
    const sidebarClose = document.getElementById('sidebar-close');

    timerBar.addEventListener('click', () => {
      sidebar.classList.toggle('open');
    });

    sidebarClose.addEventListener('click', () => {
      sidebar.classList.remove('open');
    });

    // Close sidebar when clicking outside of it
    document.addEventListener('click', (e) => {
      if (sidebar.classList.contains('open') &&
          !sidebar.contains(e.target) &&
          !timerBar.contains(e.target)) {
        sidebar.classList.remove('open');
      }
    });
  </script>
</body>

</html>