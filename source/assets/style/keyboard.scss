@use "./ease";

.piano-key{
	transition: 
        opacity var(--time-quick, 90ms) linear,
        fill 4ms linear;

    border-radius: 10%;

	fill:var(--fill, white);
    will-change: fill;

	.piano-key-name{
		visibility: hidden;
	}

	&:hover{
		fill: var(--col-green);
        // opacity: 0.98;
		.piano-key-name{
			visibility: visible;
		}		
	}	

    &.active{
		fill: var(--col-accent, var(--col-orange, orange));
		// opacity: 0;
	}
    &.active:hover{
		fill: color-mix(in oklch, var(--col-accent) 50%, var(--fill));
	}

	&:focus{
		outline: none;
	}

	&:focus-visible{
		outline: none;
		stroke-width:4px;
		stroke: var(--col-orange);
	} 
}

.piano-key-white{
	--fill: var(--col-white, white);
}

.piano-key-black{
	--fill: var(--col-black, black);
	&:focus-visible{
		stroke-width:4px;
		stroke: var(--col-orange);
	}
}

.piano-key-indicators{
	pointer-events: none;
}

.piano-note-indicator{
	transition: opacity var(--time-quick, 90ms) linear;
	stroke: var(--col-white);
	stroke-width:0.3;
	fill: var(--col-orange);
	opacity: 0;
}


// peeking
.piano{
	// we always want the smallest size for the footer
    --footer-height:clamp(33px, 10vmin, 10vh);
    --footer-height:clamp(60px, 10vh, 200px);

	--overhang:calc(-50% + 50vw);
 	--c:calc(100% - var(--footer-height) );
	// margin-top:calc( -1 * var(--c) );

	min-height:calc( 100px +  var(--footer-height));
	//width: min(100%, 100vw);
	
    max-width: min( 100%, 100vw );
    max-width: min( 100%, 100dvw );

	overflow: hidden;
	display: flex;
	flex-direction: column;

   	position: sticky;
    bottom:0; // calc( -1 * var(--footer-height,0 ));
	
	transition: bottom var(--time-medium, 90ms) ease.$easeOutBack; 
	pointer-events: none;
	z-index: 909;

    // background-color: black;
	// transform: translateX(-50%);

	.piano-keys{
		// we want the piano to be in the middle of the screen
		// so we move it 50% of it's own width to the left then 50% of the screen to the right

		pointer-events: all;
		
		// peeking
		// transform: translateY( calc( var(--c) ) ) translateX( var(--overhang) );
		// full soze
		transform: translateY( 0 ) translateX( var(--overhang) );
	
		
		transition: transform var(--time-medium, 90ms) ease.$easeOutBack; 
         position: absolute;
         bottom: 0;

		margin:auto;
		margin-bottom: 0;
		
		// padding-right: 100%;
		// left:50%;

		// make sure that it cannot be taller than 1/4 of the viewport height
		max-height:min(148px, 33vh);

		// ensure that it never shrinks to unusable size
		min-width:max( 100%, calc( 128 * 11px) );
	}
}

// Full size
.piano.show-full-keyboard{
	.piano-keys{
		transform: translateY( 0 ) translateX( var(--overhang) );
	}
}

/* Accessible checkbox styles: larger hit area (>=48px) and clearer visuals */
input[type="checkbox"]{
	--visual-size: 20px;
	-webkit-appearance: none;
	appearance: none;
	
	width: var(--visual-size);
	height: var(--visual-size);
	margin: 0;
	
	padding: calc((48px - var(--visual-size)) / 2);
	box-sizing: content-box;
	
	position: relative;
	cursor: pointer;
	vertical-align: middle;
	display: inline-block;
}

/* draw the visible box using ::after so the padded area remains clickable but visually compact */
input[type="checkbox"]::after{
	content: '';
	position: absolute;
	left: calc((100% - var(--visual-size)) / 2 - ( (48px - var(--visual-size)) / 2 ));
	top: calc((100% - var(--visual-size)) / 2 - ( (48px - var(--visual-size)) / 2 ));
	width: var(--visual-size);
	height: var(--visual-size);
	border-radius: 4px;
	background: light-dark(var(--col-white), color-mix(in oklch, var(--col-white) 90%, var(--col-black)));
	border: 2px solid light-dark(
		color-mix(in oklch, var(--col-black) 20%, var(--col-white)),
		color-mix(in oklch, var(--col-white) 20%, var(--col-black))
	);
	box-shadow: 0 1px 0 rgba(0,0,0,0.03) inset;
	transition: background .12s ease, border-color .12s ease, box-shadow .12s ease;
}

input[type="checkbox"]:checked::after{
	background: var(--col-blue);
	border-color: var(--col-blue);
	box-shadow: inset 0 0 0 3px var(--col-white);
}

input[type="checkbox"]:focus-visible{
	outline: none;
}

input[type="checkbox"]:focus-visible::after{
	box-shadow: 0 0 0 4px light-dark(
		color-mix(in oklch, var(--col-blue) 14%, transparent),
		color-mix(in oklch, var(--col-blue) 14%, transparent)
	), inset 0 1px 0 rgba(0,0,0,0.03);
}

/* increase hit area for labels that wrap checkboxes as well */
label > input[type="checkbox"]{
	display: inline-block;
}

/* When the checkbox is disabled, show a muted style */
input[type="checkbox"][disabled]::after{
	background: light-dark(
		color-mix(in oklch, var(--col-white) 95%, var(--col-black)),
		color-mix(in oklch, var(--col-white) 20%, var(--col-black))
	);
	border-color: light-dark(
		color-mix(in oklch, var(--col-black) 13%, var(--col-white)),
		color-mix(in oklch, var(--col-white) 35%, var(--col-black))
	);
	opacity: 0.8;
}

